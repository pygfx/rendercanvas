<!-- adapted from: https://traineq.org/imgui_bundle_online/projects/min_bundle_pyodide_app/demo_heart.source.txt -->
<!doctype html>
<html>

<head>
    <title>RenderCanvas HTML canvas via Pyodide</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.29.0/full/pyodide.js"></script>
    <style>
        /* so the demo page can have interactive resizing */
        #rendercanvas {
            position: absolute;
            width: 90%;
            height: 90%;
        }
    </style>
</head>

<body>
    <!-- WIP: make it more of a "Playground"? -->
    <select id="example-select">
        <option value="events.py">events.py</option>
        <option value="noise.py">noise.py</option>
        <option value="snake.py">snake.py</option>
    </select>
    <!-- maybe something like add example (to test spawning more canvases and also closing them?) -->
    <button id="reload-example">Reload example</button>
    <button id="reload-page" style="background-color: orange;" onclick="location.reload();">Reload page</button>
    <select id="lib-path">
        <option value="../dist/rendercanvas-2.2.1-py3-none-any.whl" selected>local ./dist/</option>
        <option value="rendercanvas">latest PyPI</option>
    </select>
    <input type="checkbox" id="load-wgpu">Load WebGPU (experimental)</input>
    <br>
    <!-- maybe wrap in a div so content after it still shows? -->
    <canvas id="rendercanvas" style="background-color: lightgrey;"></canvas><br>
    some text below the canvas!
    <!-- TODO: redirect the Python stdout/stderr to some kind of text box at the bottom -->
    <script type="text/javascript">

        async function loadPythonExample(example_path) {
            let response = await fetch(example_path);
            let pythonCode = await response.text();
            return pythonCode;
        }

        async function main() {

            // fetch the file locally for easier scripting
            // start chrome --allow-file-access-from-files %cd%\examples\local_browser.html or local webserver
            // TODO: replace the actual code here (unless you have the module)
            let example_select = document.getElementById("example-select");
            let reload_example_button = document.getElementById("reload-example");
            pythonCode = await (await fetch(example_select.value)).text();

            // Load Pyodide
            let pyodide = await loadPyodide();

            await pyodide.loadPackage("micropip");
            const micropip = pyodide.pyimport("micropip");
            await micropip.install('numpy');
            // await micropip.install('rendercanvas');
            await micropip.install('../dist/rendercanvas-2.2.1-py3-none-any.whl'); // local wheel for auto testing

            // Run the Python code async because some calls are async it seems.
            pyodide.runPythonAsync(pythonCode);

            // on click, we reload the example (or a difference one)
            reload_example_button.onclick = async function () {
                // interrupt existing code?
                // sounds complex: https://pyodide.org/en/stable/usage/keyboard-interrupts.html
                pyodide.setInterruptBuffer([2]);
                pyodide.setInterruptBuffer([2]);

                let example_file = example_select.value;
                pythonCode = await (await fetch(example_file)).text();
                pyodide.runPythonAsync(pythonCode);
            };
        }
        main();
    </script>

    <div style='background:#f00'>hey</div>
</body>

</html>